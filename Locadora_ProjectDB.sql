--CRIANDO BANCO
CREATE DATABASE LOCADORA_FILMES

--ACESSANDO BANCO
USE LOCADORA_FILMES

--CRIANDO TABELA GENERO
CREATE  TABLE GENERO
(
	COD_GENERO INT IDENTITY NOT NULL PRIMARY KEY,
	DESCRICAO_GENERO VARCHAR(50) NOT NULL

)

select * from GENERO

--CRIANDO TABELA FILME
CREATE TABLE FILME
(
	COD_FILME INT IDENTITY NOT NULL PRIMARY KEY,
	NOME_FILME	VARCHAR(50) NOT NULL,
	DURACAO_FILME INT NOT NULL,
	COD_GENERO INT NOT NULL
)

--FOREIGN KEY FILME
ALTER TABLE FILME
	add foreign key (COD_GENERO) references GENERO(COD_GENERO)

--CRIANDO TABELA FITA
CREATE TABLE FITA
(
	NUM_FITA INT IDENTITY NOT NULL PRIMARY KEY,
	COD_FILME INT NOT NULL

)

--FOREIGN KEY FITA
ALTER TABLE FITA
	add foreign key (COD_FILME) references FILME(COD_FILME)


--CRIANDO TABELA CLIENTE
CREATE TABLE CLIENTE
(
	CPF_CLIENTE CHAR(11) NOT NULL PRIMARY KEY,
	NOME_CLIENTE VARCHAR(50) NOT NULL,
	ENDERECO_CLIENTE VARCHAR(50) NOT NULL,
	TELEFONE_CLIENTE CHAR(10) NOT NULL
)

SELECT * FROM CLIENTE

CREATE TABLE ALOCACAO
(
	NUM_FITA INT NOT NULL,
	CPF_CLIENTE CHAR(11) NOT NULL,
	DATA_ALOCACAO datetime NOT NULL DEFAULT (getdate())
	PRIMARY KEY (NUM_FITA, CPF_CLIENTE, DATA_ALOCACAO)
)

ALTER TABLE ALOCACAO
	add 
		foreign key (NUM_FITA) references FITA(NUM_FITA),
		foreign key (CPF_CLIENTE) references CLIENTE(CPF_CLIENTE)

--INSERT NA TABELA GENERO
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('COMEDIA');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('POLICIAL');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('ROMANCE');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('SUSPENSE');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('TERROR');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('DOCUMENTARIO');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('DRAMA');
INSERT INTO GENERO(DESCRICAO_GENERO) VALUES ('FICCAO CIENTIFICA');

SELECT * FROM GENERO

DELETE FROM GENERO
WHERE COD_GENERO = 1

INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('ODEIO O DIA DOS NAMORADOS'     ,       100     ,       1       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('ZERANDO A VIDA' ,       108     ,       1       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('UMA COMEDIA NADA ROMANTICA'     ,       82      ,       1       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('BEM CASADOS'    ,       90      ,       1       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('TROPA DE ELITE' ,       115     ,       2       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('FEDERAL',       91      ,       2       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O ULTIMO GOLPE' ,       94      ,       2       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('DE VOLTA AO JOGO'       ,       111     ,       2       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O AMOR NO DIVÃ' ,       88      ,       3       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('ENTRE IDAS E VINDAS'    ,       95      ,       3       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('SIMPLESMENTE ACONTECE'  ,       102     ,       3       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('FAROESTE CABLOCO'       ,       105     ,       3       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('SONHOS LUCIDOS' ,       101     ,       4       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O CAÇADOR'      ,       101     ,       4       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('ANTES DE DORMIR',       91      ,       4       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('REGRESSÃO'      ,       106     ,       4       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('DRACULA',       92      ,       5       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O CHAMADO'      ,       115     ,       5       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('ANACONDA'       ,       89      ,       5       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O EXORCISMO'    ,       119     ,       5       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('SENNA'  ,       95      ,       6       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('TRANSPATAGONIA' ,       63      ,       6       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('CIDADE DE DEUS 10 ANOS DEPOIS'  ,       68      ,       6       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('LIVING ON ONE DOLAR'    ,       56      ,       6       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('CAZUZA' ,       96      ,       7       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('GENIO INDOMAVEL',       126     ,       7       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('MUNDO CAO'      ,       100     ,       7       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('DEUS NAO ESTA MORTO'    ,       112     ,       7       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('MATRIX' ,       136     ,       8       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O DIA DEPOIS DE AMANHA' ,       123     ,       8       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('STAR WARS'      ,       136     ,       8       );
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('O SENHOR DOS ANEIS'     ,       200     ,       8       ); 
INSERT INTO FILME(NOME_FILME, DURACAO_FILME, COD_GENERO) VALUES ('TESTE'     ,       200     ,       10       ); 



SELECT * FROM FILME

INSERT INTO FITA (COD_FILME) VALUES (	1	);
INSERT INTO FITA (COD_FILME) VALUES (	1	);
INSERT INTO FITA (COD_FILME) VALUES (	2	);
INSERT INTO FITA (COD_FILME) VALUES (	2	);
INSERT INTO FITA (COD_FILME) VALUES (	2	);
INSERT INTO FITA (COD_FILME) VALUES (	3	);
INSERT INTO FITA (COD_FILME) VALUES (	4	);
INSERT INTO FITA (COD_FILME) VALUES (	4	);
INSERT INTO FITA (COD_FILME) VALUES (	5	);
INSERT INTO FITA (COD_FILME) VALUES (	5	);
INSERT INTO FITA (COD_FILME) VALUES (	5	);
INSERT INTO FITA (COD_FILME) VALUES (	6	);
INSERT INTO FITA (COD_FILME) VALUES (	6	);
INSERT INTO FITA (COD_FILME) VALUES (	7	);
INSERT INTO FITA (COD_FILME) VALUES (	7	);
INSERT INTO FITA (COD_FILME) VALUES (	7	);
INSERT INTO FITA (COD_FILME) VALUES (	7	);
INSERT INTO FITA (COD_FILME) VALUES (	8	);
INSERT INTO FITA (COD_FILME) VALUES (	9	);
INSERT INTO FITA (COD_FILME) VALUES (	9	);
INSERT INTO FITA (COD_FILME) VALUES (	10	);
INSERT INTO FITA (COD_FILME) VALUES (	10	);
INSERT INTO FITA (COD_FILME) VALUES (	11	);
INSERT INTO FITA (COD_FILME) VALUES (	11	);
INSERT INTO FITA (COD_FILME) VALUES (	11	);
INSERT INTO FITA (COD_FILME) VALUES (	12	);
INSERT INTO FITA (COD_FILME) VALUES (	12	);
INSERT INTO FITA (COD_FILME) VALUES (	13	);
INSERT INTO FITA (COD_FILME) VALUES (	14	);
INSERT INTO FITA (COD_FILME) VALUES (	14	);
INSERT INTO FITA (COD_FILME) VALUES (	15	);
INSERT INTO FITA (COD_FILME) VALUES (	15	);
INSERT INTO FITA (COD_FILME) VALUES (	15	);
INSERT INTO FITA (COD_FILME) VALUES (	16	);
INSERT INTO FITA (COD_FILME) VALUES (	17	);
INSERT INTO FITA (COD_FILME) VALUES (	17	);
INSERT INTO FITA (COD_FILME) VALUES (	18	);
INSERT INTO FITA (COD_FILME) VALUES (	19	);
INSERT INTO FITA (COD_FILME) VALUES (	19	);
INSERT INTO FITA (COD_FILME) VALUES (	20	);
INSERT INTO FITA (COD_FILME) VALUES (	21	);
INSERT INTO FITA (COD_FILME) VALUES (	21	);
INSERT INTO FITA (COD_FILME) VALUES (	22	);
INSERT INTO FITA (COD_FILME) VALUES (	22	);
INSERT INTO FITA (COD_FILME) VALUES (	22	);
INSERT INTO FITA (COD_FILME) VALUES (	23	);
INSERT INTO FITA (COD_FILME) VALUES (	23	);
INSERT INTO FITA (COD_FILME) VALUES (	24	);
INSERT INTO FITA (COD_FILME) VALUES (	25	);
INSERT INTO FITA (COD_FILME) VALUES (	26	);
INSERT INTO FITA (COD_FILME) VALUES (	27	);
INSERT INTO FITA (COD_FILME) VALUES (	27	);
INSERT INTO FITA (COD_FILME) VALUES (	28	);
INSERT INTO FITA (COD_FILME) VALUES (	29	);
INSERT INTO FITA (COD_FILME) VALUES (	30	);
INSERT INTO FITA (COD_FILME) VALUES (	30	);
INSERT INTO FITA (COD_FILME) VALUES (	31	);
INSERT INTO FITA (COD_FILME) VALUES (	31	);
INSERT INTO FITA (COD_FILME) VALUES (	31	);
INSERT INTO FITA (COD_FILME) VALUES (	32	);
INSERT INTO FITA (COD_FILME) VALUES (	32	);

INSERT INTO CLIENTE VALUES('11111111111','ADRIANA SIQUEIRA' ,'RUA AAA' ,'7119191919'     );
INSERT INTO CLIENTE VALUES('22222222222','JULIO MARTINZ'  ,'RUA BBB' ,'7529291111'     );
INSERT INTO CLIENTE VALUES('33333333333','PEDRO BASTOS'   ,'RUA CCC' ,'7187736252'     );
INSERT INTO CLIENTE VALUES('44444444444','MARIA ESTER NOVAES','RUA DDD' ,'7184848484'     );
INSERT INTO CLIENTE VALUES('55555555555','JULIANA MUNHOZ' ,'RUA EEE' ,'7182828282'     );
INSERT INTO CLIENTE VALUES('66666666666','LETICIA TAVARES','RUA FFF' ,'7183848585'     );
INSERT INTO CLIENTE VALUES('77777777777','ROBERTO TEIXEIRA' ,'RUA GGG' ,'7194838282'     );

INSERT INTO CLIENTE VALUES('88888888888','FULANO DE TAL' ,'RUA HHH' ,'7188244637'     );     
INSERT INTO CLIENTE VALUES('99999999999','SICRANO DE TAL' ,'RUA III' ,'7188883888'     );                                                                                        

insert into ALOCACAO values ( 1  , '11111111111', '01/02/2017');
insert into ALOCACAO values ( 6  , '11111111111', '01/03/2017');
insert into ALOCACAO values ( 7  , '11111111111', '01/02/2017');
insert into ALOCACAO values ( 20 , '11111111111', '01/04/2017');
insert into ALOCACAO values ( 3  , '22222222222', '02/05/2017');
insert into ALOCACAO values ( 8  , '22222222222', '02/07/2017');
insert into ALOCACAO values ( 9  , '22222222222', '02/08/2017');
insert into ALOCACAO values ( 15 , '22222222222', '02/08/2017');
insert into ALOCACAO values ( 25 , '33333333333', '01/02/2017');
insert into ALOCACAO values ( 30 , '33333333333', '01/03/2017');
insert into ALOCACAO values ( 2  , '33333333333', '01/02/2017');
insert into ALOCACAO values ( 7  , '33333333333', '01/04/2017');
insert into ALOCACAO values ( 60 , '44444444444', '01/02/2017');
insert into ALOCACAO values ( 40 , '44444444444', '01/04/2017');
insert into ALOCACAO values ( 30 , '44444444444', '02/05/2017');
insert into ALOCACAO values ( 10 , '44444444444', '02/07/2017');
insert into ALOCACAO values ( 5  , '55555555555', '01/02/2017');
insert into ALOCACAO values ( 10 , '55555555555', '01/04/2017');
insert into ALOCACAO values ( 20 , '55555555555', '01/02/2017');
insert into ALOCACAO values ( 60 , '55555555555', '01/04/2017');
insert into ALOCACAO values ( 4  , '66666666666', '02/05/2017');
insert into ALOCACAO values ( 8  , '66666666666', '02/07/2017');
insert into ALOCACAO values ( 30 , '66666666666', '02/08/2017');
insert into ALOCACAO values ( 61 , '66666666666', '02/08/2017');
insert into ALOCACAO values ( 63 , '77777777777', '01/02/2017');
insert into ALOCACAO values ( 64 , '77777777777', '01/04/2017');
insert into ALOCACAO values ( 13 , '77777777777', '02/05/2017');
insert into ALOCACAO values ( 18 , '77777777777', '02/07/2017');


SELECT F.NOME_FILME, F.DURACAO_FILME, G.DESCRICAO_GENERO
FROM FILME F, GENERO G
WHERE F.COD_GENERO  = G.COD_GENERO 
AND F.COD_GENERO = 8

SELECT C.NOME_CLIENTE, FI.NOME_FILME , G.DESCRICAO_GENERO, A.DATA_ALOCACAO
FROM CLIENTE C, ALOCACAO A, FITA F, FILME FI, GENERO G
WHERE A.CPF_CLIENTE = C.CPF_CLIENTE
AND A.NUM_FITA = F.NUM_FITA
AND F.COD_FILME = FI.COD_FILME
AND FI.COD_GENERO = G.COD_GENERO
--AND C.CPF_CLIENTE = '55555555555'
AND G.COD_GENERO = 1


SELECT * FROM ALOCACAO

UPDATE ALOCACAO
SET CPF_CLIENTE = '88888888888'
WHERE CPF_CLIENTE = '77777777777'


UPDATE ALOCACAO
SET CPF_CLIENTE = '99999999999'
WHERE CPF_CLIENTE = '88888888888'

DELETE FROM ALOCACAO
WHERE CPF_CLIENTE = '99999999999'

